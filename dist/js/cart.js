"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),a.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}require(["require-config"],function(){require(["template","header","footer"],function(e){new(function(){function t(){_classCallCheck(this,t),this.container=$("#goodsList"),this.init()}return _createClass(t,[{key:"init",value:function(){var t=localStorage.getItem("cart");t&&(this.cart=JSON.parse(t),this.render(this.cart)),this.delegateEvent()}},{key:"render",value:function(t){$("#goodsList").html(e("cart-template",{cartli:t}))}},{key:"delegateEvent",value:function(){var c=this;this.container.on("click",".plus",function(){var t=Number($(this).prev().val()),e=$(this).parentsUntil($("div"),".goods"),n=e.find(".subtotal"),a=n.html(),i=e.find(".ok").attr("data-check"),r=1*e.attr("data-id");t++,$(this).prev().val(t),n.attr("data-money",t*a),"true"===i&&c.calcTotal(),c.changeCart({id:r,num:t,check:i})}),this.container.on("click",".minus",function(){var t=Number($(this).next().val()),e=$(this).parentsUntil($("div"),".goods"),n=e.find(".subtotal"),a=n.html(),i=e.find(".ok").attr("data-check"),r=1*$(this).parentsUntil($("div"),".goods").attr("data-id");0==--t&&(t=1),$(this).next().val(t),n.attr("data-money",t*a),"true"===i&&c.calcTotal(),c.changeCart({id:r,num:t,check:i})}),this.container.on("click",".ok",function(){var t,e=1*$(this).parentsUntil($("div"),".goods").attr("data-id");t="true"===$(this).attr("data-check")?($(this).removeClass("glyphicon glyphicon-ok check"),$(this).attr("data-check",!1),"false"):($(this).addClass("glyphicon glyphicon-ok check"),$(this).attr("data-check",!0),"true"),c.calcTotal(),c.changeCart({id:e,check:t})}),this.container.on("click",".glyphicon-trash",function(){if(confirm("你确定要删除该商品吗")){var t=$(this).parent().parent().attr("data-id");$(this).parent().parent().remove(),c.calcTotal(),c.delGood(t)}}),this.calcTotal()}},{key:"calcTotal",value:function(){var n=0,a=0,t=this.container.find(".ok[data-check='true']");$.each($(t),function(t,e){n+=1*$(e).parentsUntil("div",".goods").find(".subtotal").attr("data-money"),a+=1*$(e).parentsUntil("div",".goods").find(".numInput").val()}),this.container.find("#total").html("￥".concat(n.toFixed(2))),this.container.find("i").html("(".concat(a,")"))}},{key:"changeCart",value:function(n){var a=-1,t=null,e=null,i=n.num,r="true"===n.check?"true":"false",c="true"===n.check?"glyphicon glyphicon-ok check ok":"ok";this.cart.some(function(t,e){return a=e,t.id===n.id}),t=_objectSpread({},t=this.cart[a],{num:i=i||t.num,check:r,cls:c}),(e=this.cart).splice(a,1,t),localStorage.setItem("cart",JSON.stringify(e))}},{key:"delGood",value:function(n){var a=-1,t=this.cart;t.some(function(t,e){return a=e,t.id===1*n}),t.splice(a,1),localStorage.setItem("cart",JSON.stringify(t))}}]),t}())})});